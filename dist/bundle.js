"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var React=_interopDefault(require("react")),reactDom=require("react-dom"),computeLayout=_interopDefault(require("css-layout"));function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),o.forEach(function(t){_defineProperty(e,t,r[t])})}return e}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _typeof2(t){return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(t){return _typeof2(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof2(t)})(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}var Flexbox=function(t){function e(){var t;return _classCallCheck(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this)))._shouldUpdateAgain=!1,t.state={layout:{children:[]}},t}return _inherits(e,React.Component),_createClass(e,[{key:"componentDidMount",value:function(){this.forceUpdate()}},{key:"componentDidUpdate",value:function(){if(this._shouldUpdateAgain=!this._shouldUpdateAgain,this._shouldUpdateAgain){var t=this.getChildrenMeasured(this._childRefs),e=this.getChildren(this.props.children),r=this.getChildrenAsMergedStyles(e,t),o=this.getComputedLayout(r,this.props.style);this.props.onLayout(o),this.setState({layout:o})}}},{key:"getChildren",value:function(t){return t.filter(function(t){return t}).filter(function(t){return"string"!=typeof t}).map(function(t){return Array.isArray(t)?t:[t]}).reduce(function(t,e){return t.concat(e)},[])}},{key:"getChildrenAsMergedStyles",value:function(n,t){return t.map(function(t,e){var r=n[e]||{},o=r&&r.props?r.props.style:{};return{style:_objectSpread({},o,{height:t.height||o.height,width:t.width||o.width})}})}},{key:"getChildrenMeasured",value:function(t){return t&&t.length?t.map(function(t){return t.getBBox?t.getBBox():reactDom.findDOMNode(t).getBBox()}):[]}},{key:"getComputedLayout",value:function(t,e){var r={children:_toConsumableArray(t||[]),style:_objectSpread({},e)};return computeLayout(r),r}},{key:"getLayoutChildren",value:function(t){return t&&t.children&&t.children.length?t.children:[]}},{key:"getLayoutAttributesForChild",value:function(t,e){if(e&&e.layout){var r=e.layout,o=r.left,n=r.top;switch(t.type){case"circle":var i=t.props.r||0;return{cx:o+i,cy:n+i};case"ellipse":return{cx:o+(t.props.rx||0),cy:n+(t.props.ry||0)};case"g":case"path":case"polygon":case"polyline":return{transform:"translate(".concat(o," ").concat(n,")")};default:return{x:o,y:n}}}return{}}},{key:"render",value:function(){var r=this;this._childRefs=[];var t=this.getChildren(this.props.children),o=this.getLayoutChildren(this.state.layout);return React.createElement("g",{className:this.props.className,transform:"translate(".concat(this.props.x," ").concat(this.props.y,")")},t.map(function(t,e){return React.cloneElement(t,_objectSpread({},t.props,r.getLayoutAttributesForChild(t,o[e]),{key:"flexboxChild".concat(e),ref:function(t){return t?r._childRefs.push(t):null}}))}))}}]),e}();Flexbox.defaultProps={children:[],className:null,onLayout:function(){},style:{},x:0,y:0},module.exports=Flexbox;
